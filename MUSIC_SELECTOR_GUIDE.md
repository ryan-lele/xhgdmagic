# 音乐选择器使用指南

## 🎵 概述

为"宁静魔法"助眠应用创建了一个完整的音乐选择和管理系统，允许您搜索、试听并添加适合助眠的音乐到项目中。

## 📁 创建的文件

### 1. 数据结构文件
- **`src/data/music.ts`** - 音乐数据结构和本地存储管理
  - 定义了 `MusicTrack` 接口
  - 提供了 `MusicManager` 类用于数据管理
  - 包含预定义的助眠音乐数据

### 2. 服务文件
- **`src/services/musicSearchService.ts`** - 音乐搜索服务
  - 集成多个免费音乐源（Pixabay、Freesound）
  - 提供模拟数据作为备选方案
  - 支持按分类搜索音乐

### 3. 组件文件
- **`src/components/PixabayMusicSelector.tsx`** - 音乐选择器组件
  - 搜索界面
  - 试听功能
  - 添加到项目功能

### 4. 页面文件
- **`src/pages/MusicManager.tsx`** - 音乐管理页面
  - 音乐库管理
  - 搜索和过滤
  - 播放控制

### 5. 更新的文件
- **`src/App.tsx`** - 添加了音乐管理路由
- **`src/components/Layout.tsx`** - 添加了音乐管理导航
- **`src/hooks/usePageTracking.ts`** - 添加了音乐管理页面跟踪

## 🚀 如何使用

### 1. 访问音乐管理页面
- 在应用底部导航栏点击"音乐"图标
- 或直接访问 `/music` 路由

### 2. 添加新音乐
1. 点击"添加音乐"按钮
2. 在搜索框中输入关键词（如：sleep, relax, meditation）
3. 浏览搜索结果
4. 点击"试听"按钮预览音乐
5. 点击"添加"按钮将音乐添加到项目

### 3. 管理音乐库
- **搜索音乐**：使用搜索框按标题、艺术家或标签搜索
- **分类过滤**：使用下拉菜单按分类过滤音乐
- **播放音乐**：点击播放按钮试听音乐
- **删除音乐**：点击删除按钮移除不需要的音乐

## 🎯 功能特性

### 搜索功能
- 支持多种搜索关键词：sleep, relax, meditation, lofi, ambient, nature
- 实时搜索和过滤
- 预定义快速搜索标签

### 音乐分类
- **助眠音乐** (sleep) - 帮助入睡的舒缓音乐
- **放松音乐** (relax) - 缓解压力的轻松音乐
- **冥想音乐** (meditation) - 适合冥想和正念的音乐
- **Lo-Fi 音乐** (lofi) - 低保真度的怀旧音乐
- **环境音乐** (ambient) - 营造氛围的环境音效
- **自然声音** (nature) - 来自大自然的原始声音

### 播放控制
- 试听功能
- 音量控制
- 播放/暂停切换
- 自动停止播放

### 数据管理
- 本地存储音乐数据
- 自动分类识别
- 数据持久化
- 导入/导出功能（可扩展）

## 🔧 技术实现

### API 集成
- **Pixabay 视频 API** - 搜索包含背景音乐的视频内容 ✅ 已激活
- **Freesound API** - 免费音效库 ⏸️ 暂时禁用
- **模拟数据** - 当 API 不可用时使用

### 数据存储
- 使用 `localStorage` 进行本地存储
- 支持数据的增删改查
- 自动备份和恢复

### 用户体验
- 响应式设计
- 流畅的动画效果
- 直观的操作界面
- 实时反馈

## 📝 配置说明

### API 密钥配置
在 `src/services/musicSearchService.ts` 中已配置您的 Pixabay API 密钥：

```typescript
private static readonly PIXABAY_API_KEY = '52102246-e7c2cc20650a65ef7bea20e59'; // 已配置
private static readonly FREESOUND_API_KEY = ''; // 暂时不使用
```

### API 状态
1. **Pixabay API**：✅ 已配置并激活
   - 使用视频 API 搜索包含背景音乐的视频内容
   - 支持按音乐类别、时长等条件筛选
   - 自动提取视频中的音频信息

2. **Freesound API**：⏸️ 暂时禁用
   - 可以后续配置以扩展音乐源

## 🎨 自定义配置

### 添加新的音乐分类
在 `src/data/music.ts` 中的 `musicCategories` 对象中添加新分类：

```typescript
newCategory: {
  name: '新分类名称',
  description: '分类描述',
  keywords: ['关键词1', '关键词2']
}
```

### 修改默认音乐
在 `src/data/music.ts` 中的 `defaultMusicTracks` 数组中添加或修改默认音乐。

### 自定义搜索关键词
在 `src/components/PixabayMusicSelector.tsx` 中的 `predefinedQueries` 数组中添加新的搜索关键词。

## 🔍 故障排除

### 常见问题

1. **搜索无结果**
   - 检查网络连接
   - 验证 API 密钥配置
   - 使用模拟数据进行测试

2. **音频无法播放**
   - 检查音频 URL 是否有效
   - 确认浏览器支持音频格式
   - 检查网络连接

3. **数据丢失**
   - 检查浏览器本地存储设置
   - 使用"重置为默认"功能恢复数据

### 调试模式
在浏览器开发者工具中查看控制台日志，获取详细的错误信息。

## 📈 扩展功能

### 可添加的功能
1. **音乐上传** - 支持用户上传本地音乐文件
2. **播放列表** - 创建和管理播放列表
3. **音乐推荐** - 基于用户偏好的智能推荐
4. **云端同步** - 将音乐数据同步到云端
5. **社交功能** - 分享音乐和播放列表
6. **高级搜索** - 按时长、音质等条件搜索

### 性能优化
1. **懒加载** - 按需加载音乐数据
2. **缓存机制** - 缓存搜索结果
3. **压缩优化** - 优化音频文件大小
4. **CDN 加速** - 使用 CDN 加速音频加载

## 🎉 总结

音乐选择器系统为"宁静魔法"应用提供了完整的音乐管理功能，包括搜索、试听、分类和管理。系统设计灵活，易于扩展，为用户提供了丰富的助眠音乐选择。

通过这个系统，您可以：
- 轻松搜索和添加助眠音乐
- 管理个人音乐库
- 享受流畅的音乐体验
- 为应用构建丰富的音乐内容

现在您可以开始使用这个音乐选择器来为您的助眠应用添加高质量的音乐内容了！
