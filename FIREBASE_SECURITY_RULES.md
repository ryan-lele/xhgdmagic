# Firebase Firestore å®‰å…¨è§„åˆ™é…ç½®æŒ‡å—

## ğŸ”’ å®‰å…¨è§„åˆ™æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›äº†"å®é™é­”æ³•"åº”ç”¨æ‰€éœ€çš„ Firebase Firestore å®‰å…¨è§„åˆ™é…ç½®ã€‚

## ğŸ“‹ è§„åˆ™è¯´æ˜

### 1. ç”¨æˆ·æ•°æ®è®¿é—®è§„åˆ™
```javascript
match /users/{userId} {
  allow read, write: if request.auth != null && request.auth.uid == userId;
}
```
- **åŠŸèƒ½**ï¼šå…è®¸ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è¯»å†™è‡ªå·±çš„ç”¨æˆ·æ•°æ®
- **é€‚ç”¨åœºæ™¯**ï¼šç”¨æˆ·ä¸ªäººèµ„æ–™ã€è®¾ç½®ç­‰æ•°æ®

### 2. ç”¨æˆ·æ”¶è—æ•°æ®è§„åˆ™
```javascript
match /users/{userId}/favorites/{favoriteId} {
  allow read, write: if request.auth != null && request.auth.uid == userId;
}
```
- **åŠŸèƒ½**ï¼šå…è®¸ç”¨æˆ·ç®¡ç†è‡ªå·±çš„æ”¶è—å†…å®¹
- **é€‚ç”¨åœºæ™¯**ï¼šæ”¶è—çš„éŸ³ä¹ã€æ•…äº‹ç­‰

### 3. ç”¨æˆ·æ”¶è—æ•…äº‹è§„åˆ™
```javascript
match /users/{userId}/favoriteStories/{storyId} {
  allow read, write: if request.auth != null && request.auth.uid == userId;
}
```
- **åŠŸèƒ½**ï¼šå…è®¸ç”¨æˆ·ç®¡ç†è‡ªå·±çš„æ”¶è—æ•…äº‹
- **é€‚ç”¨åœºæ™¯**ï¼šæ•…äº‹æ”¶è—åŠŸèƒ½

### 4. å…¨å±€éŸ³ä¹åº“è§„åˆ™
```javascript
match /music/{musicId} {
  allow read: if request.auth != null;
  allow write: if request.auth != null && request.auth.uid in ['admin-uid-here'];
}
```
- **åŠŸèƒ½**ï¼šæ‰€æœ‰ç”¨æˆ·å¯è¯»å–ï¼Œä»…ç®¡ç†å‘˜å¯å†™å…¥
- **é€‚ç”¨åœºæ™¯**ï¼šå…¨å±€éŸ³ä¹åº“ç®¡ç†

### 5. å…¨å±€æ•…äº‹åº“è§„åˆ™
```javascript
match /stories/{storyId} {
  allow read: if request.auth != null;
  allow write: if request.auth != null && request.auth.uid in ['admin-uid-here'];
}
```
- **åŠŸèƒ½**ï¼šæ‰€æœ‰ç”¨æˆ·å¯è¯»å–ï¼Œä»…ç®¡ç†å‘˜å¯å†™å…¥
- **é€‚ç”¨åœºæ™¯**ï¼šå…¨å±€æ•…äº‹åº“ç®¡ç†

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### æ–¹æ³•1ï¼šä½¿ç”¨ Firebase CLI

1. **å®‰è£… Firebase CLI**ï¼ˆå¦‚æœå°šæœªå®‰è£…ï¼‰ï¼š
   ```bash
   npm install -g firebase-tools
   ```

2. **ç™»å½• Firebase**ï¼š
   ```bash
   firebase login
   ```

3. **åˆå§‹åŒ–é¡¹ç›®**ï¼ˆå¦‚æœå°šæœªåˆå§‹åŒ–ï¼‰ï¼š
   ```bash
   firebase init firestore
   ```

4. **éƒ¨ç½²è§„åˆ™**ï¼š
   ```bash
   firebase deploy --only firestore:rules
   ```

### æ–¹æ³•2ï¼šä½¿ç”¨ Firebase æ§åˆ¶å°

1. **è®¿é—® Firebase æ§åˆ¶å°**ï¼š
   - æ‰“å¼€ [Firebase Console](https://console.firebase.google.com/)
   - é€‰æ‹©æ‚¨çš„é¡¹ç›®

2. **å¯¼èˆªåˆ° Firestore**ï¼š
   - åœ¨å·¦ä¾§èœå•ä¸­ç‚¹å‡» "Firestore Database"
   - ç‚¹å‡» "è§„åˆ™" æ ‡ç­¾é¡µ

3. **æ›´æ–°è§„åˆ™**ï¼š
   - å°† `firestore.rules` æ–‡ä»¶ä¸­çš„å†…å®¹å¤åˆ¶åˆ°è§„åˆ™ç¼–è¾‘å™¨ä¸­
   - ç‚¹å‡» "å‘å¸ƒ" æŒ‰é’®

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. ç®¡ç†å‘˜UIDé…ç½®
åœ¨éƒ¨ç½²å‰ï¼Œè¯·å°†è§„åˆ™ä¸­çš„ `'admin-uid-here'` æ›¿æ¢ä¸ºå®é™…çš„ç®¡ç†å‘˜ç”¨æˆ·UIDï¼š

```javascript
// æ›¿æ¢è¿™è¡Œ
allow write: if request.auth != null && request.auth.uid in ['admin-uid-here'];

// ä¸ºå®é™…çš„ç®¡ç†å‘˜UID
allow write: if request.auth != null && request.auth.uid in ['your-admin-uid-1', 'your-admin-uid-2'];
```

### 2. åŒ¿åç”¨æˆ·æ”¯æŒ
å½“å‰è§„åˆ™æ”¯æŒåŒ¿åç”¨æˆ·ï¼Œç¡®ä¿æ‚¨çš„åº”ç”¨èƒ½å¤Ÿæ­£ç¡®å¤„ç†åŒ¿åç”¨æˆ·çš„èº«ä»½éªŒè¯ã€‚

### 3. æµ‹è¯•è§„åˆ™
éƒ¨ç½²åï¼Œå»ºè®®åœ¨ Firebase æ§åˆ¶å°çš„ "è§„åˆ™" æ ‡ç­¾é¡µä¸­ä½¿ç”¨ "è§„åˆ™æ¨¡æ‹Ÿå™¨" æµ‹è¯•è§„åˆ™æ˜¯å¦æ­£ç¡®å·¥ä½œã€‚

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### æ·»åŠ æ–°çš„æ•°æ®é›†åˆ
å¦‚æœéœ€è¦æ·»åŠ æ–°çš„æ•°æ®é›†åˆï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹æ¨¡å¼æ·»åŠ è§„åˆ™ï¼š

```javascript
match /your-collection/{documentId} {
  allow read, write: if request.auth != null && request.auth.uid == userId;
}
```

### ä¿®æ”¹æƒé™çº§åˆ«
æ ¹æ®åº”ç”¨éœ€æ±‚ï¼Œæ‚¨å¯ä»¥è°ƒæ•´æƒé™çº§åˆ«ï¼š

- **åªè¯»æƒé™**ï¼š`allow read: if request.auth != null;`
- **è¯»å†™æƒé™**ï¼š`allow read, write: if request.auth != null;`
- **ç®¡ç†å‘˜æƒé™**ï¼š`allow read, write: if request.auth != null && request.auth.uid in ['admin-uid'];`

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æƒé™è¢«æ‹’ç»é”™è¯¯**
   - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²æ­£ç¡®ç™»å½•
   - éªŒè¯ç”¨æˆ·UIDæ˜¯å¦ä¸è§„åˆ™ä¸­çš„æ¡ä»¶åŒ¹é…

2. **åŒ¿åç”¨æˆ·æ— æ³•è®¿é—®**
   - ç¡®ä¿åŒ¿åç”¨æˆ·å·²é€šè¿‡ `signInAnonymously` ç™»å½•
   - æ£€æŸ¥è§„åˆ™æ˜¯å¦åŒ…å«åŒ¿åç”¨æˆ·çš„æ¡ä»¶

3. **è§„åˆ™éƒ¨ç½²å¤±è´¥**
   - æ£€æŸ¥è§„åˆ™è¯­æ³•æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿ Firebase CLI å·²æ­£ç¡®é…ç½®

### è°ƒè¯•æŠ€å·§

1. **ä½¿ç”¨è§„åˆ™æ¨¡æ‹Ÿå™¨**ï¼š
   - åœ¨ Firebase æ§åˆ¶å°ä¸­æµ‹è¯•è§„åˆ™
   - æ¨¡æ‹Ÿä¸åŒçš„ç”¨æˆ·å’Œæ“ä½œåœºæ™¯

2. **æŸ¥çœ‹é”™è¯¯æ—¥å¿—**ï¼š
   - åœ¨ Firebase æ§åˆ¶å°çš„ "ä½¿ç”¨æƒ…å†µ" æ ‡ç­¾é¡µä¸­æŸ¥çœ‹é”™è¯¯
   - æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨é…ç½®è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š

1. æ£€æŸ¥ Firebase å®˜æ–¹æ–‡æ¡£
2. æŸ¥çœ‹åº”ç”¨çš„æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
3. ä½¿ç”¨ Firebase æ§åˆ¶å°çš„è§„åˆ™æ¨¡æ‹Ÿå™¨è¿›è¡Œæµ‹è¯•

---

**æ³¨æ„**ï¼šè¿™äº›è§„åˆ™å·²ç»è¿‡æµ‹è¯•ï¼Œé€‚ç”¨äº"å®é™é­”æ³•"åº”ç”¨çš„åŸºæœ¬åŠŸèƒ½ã€‚æ ¹æ®å®é™…éœ€æ±‚ï¼Œæ‚¨å¯èƒ½éœ€è¦è¿›ä¸€æ­¥è°ƒæ•´è§„åˆ™ã€‚




